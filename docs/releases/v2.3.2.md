# Release Notes v2.3.2

**Release Date:** 2025-11-10  
**Type:** Feature Release

## ðŸš€ Major Changes

### DB Persistence for Statistics & History

**Problem:** Statistics and History were lost after Docker restarts, as they were only stored in memory.

**Solution:** 
- Statistics and History are now persisted in the SQLite database
- Data is stored in the same database as settings (`cineripr_settings.db`)
- Statistics and History are automatically loaded on startup
- Last 100 history entries are kept in the database

**Impact:** 
- Statistics (processed, failed, unsupported, deleted counts) now survive Docker restarts
- History entries are preserved across restarts
- Users can see their processing history even after container restarts

## ðŸŽ¯ Improvements

### Countdown Display Enhancement

**Change:** Countdown for next run is now always displayed when available, regardless of `repeat_mode` setting.

**Before:** Countdown was only shown when `repeat_mode` was enabled.

**After:** Countdown is displayed whenever `seconds_until_next_run` is available, making scheduled runs more visible.

## ðŸ”§ Technical Details

### Database Schema

New tables added to `cineripr_settings.db`:

**`statistics` table:**
- `processed_count` (INTEGER)
- `failed_count` (INTEGER)
- `unsupported_count` (INTEGER)
- `deleted_count` (INTEGER)
- `cleanup_failed_count` (INTEGER)
- `updated_at` (TIMESTAMP)

**`history` table:**
- `release_name` (TEXT)
- `status` (TEXT) - "completed" or "failed"
- `processed_archives` (INTEGER)
- `failed_archives` (INTEGER)
- `duration_seconds` (REAL)
- `extracted_files` (TEXT) - JSON array
- `error_messages` (TEXT) - JSON array
- `timestamp` (TIMESTAMP)

### Code Changes

- **`src/cineripr/web/settings_db.py`**: Added `save_statistics()`, `load_statistics()`, `save_history()`, `load_history()` methods
- **`src/cineripr/web/status.py`**: 
  - `StatusTracker.__init__()` now loads statistics and history from DB
  - `update_counts()` saves statistics to DB after each update
  - `add_to_history()` saves history to DB after each addition
- **`src/cineripr/cli.py`**: Calls `add_to_history()` after each processing run
- **`src/cineripr/web/webgui.py`**: Removed `repeat_mode` dependency from countdown display logic

## ðŸ“¦ Migration

No migration required. The database schema is automatically updated on first run. Existing statistics and history will start being saved from this version onwards.

## ðŸš€ Upgrade Instructions

1. Pull the latest Docker image: `docker pull ghcr.io/rokk001/cineripr:latest`
2. Restart your container
3. Statistics and History will now be persisted across restarts

---

**Full Changelog:** [v2.3.1...v2.3.2](https://github.com/Rokk001/CineRipR/compare/v2.3.1...v2.3.2)

