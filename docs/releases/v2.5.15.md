# Release Notes v2.5.15

**Release Date:** 2025-11-13  
**Type:** Bug Fix & Improvement Release

## ğŸ› Critical Bug Fixes

### History Duplikate beim Laden behoben

**Problem:** 
- Beim Laden der History aus der Datenbank wurden alle Duplikate Ã¼bernommen
- `add_to_history()` deduplizierte nur bei neuen EintrÃ¤gen, nicht bei bereits geladenen
- History zeigte endlos lange Liste mit identischen EintrÃ¤gen fÃ¼r denselben Release
- Jeder Release sollte nur einmal in der History erscheinen

**LÃ¶sung:**
- History wird jetzt beim Laden aus der DB dedupliziert
- Dictionary-basierte Aggregation nach `release_name`
- `attempt_count` wird summiert, Fehlermeldungen zusammengefÃ¼hrt
- Neuester Status und Timestamp werden verwendet

**Impact:**
- History zeigt jetzt jeden Release nur einmal
- Aggregierter `attempt_count` zeigt, wie oft ein Release verarbeitet wurde
- Ãœbersichtliche History ohne Duplikate

### Progress Live-Updates wÃ¤hrend Extraktion

**Problem:**
- Progress blieb bei einem Wert stehen (z.B. 4%) und wurde erst aktualisiert, wenn die Datei fertig war
- Progress-Callback wurde nur bei ProzentÃ¤nderung aufgerufen, nicht kontinuierlich
- Frontend zeigte keine flÃ¼ssigen Updates wÃ¤hrend der Extraktion
- Nur die erste Datei wurde angezeigt, dann Sprung zur nÃ¤chsten bei 0%

**LÃ¶sung:**
- Progress-Callback wird jetzt auch periodisch (alle 0.5 Sekunden) aufgerufen
- Initialer Callback beim Start der Extraktion
- Frontend aktualisiert Progress-Bar auch bei kleinen Ã„nderungen separat
- Zeit-basierte Updates zusÃ¤tzlich zu Prozent-basierten Updates

**Impact:**
- Progress wird kontinuierlich wÃ¤hrend der Extraktion aktualisiert
- Frontend zeigt flÃ¼ssige Updates, nicht nur SprÃ¼nge
- Bessere Benutzererfahrung mit Live-Feedback

## ğŸ¯ Improvements

### History Aggregation

- Beim Laden werden Duplikate automatisch aggregiert
- `attempt_count` wird summiert, Fehlermeldungen zusammengefÃ¼hrt
- Neuester Status und Timestamp werden verwendet
- Ãœbersichtliche History ohne redundante EintrÃ¤ge

### Progress Updates

- Progress wird jetzt kontinuierlich wÃ¤hrend der Extraktion aktualisiert
- Frontend zeigt flÃ¼ssige Updates, nicht nur SprÃ¼nge
- Initialer Progress-Callback beim Start der Extraktion
- Bessere Benutzererfahrung mit Live-Feedback

## ğŸ”§ Technical Details

### Code Changes

**`src/cineripr/web/status.py`:**
- History wird beim Laden aus DB dedupliziert
- Dictionary `history_dict = {}` fÃ¼r Aggregation nach `release_name`
- FÃ¼r jeden geladenen Eintrag: Wenn `release_name` bereits existiert, aggregieren
- `attempt_count` wird summiert, Fehlermeldungen zusammengefÃ¼hrt
- Am Ende: `self._status.history = list(history_dict.values())`

**`src/cineripr/extraction/archive_extraction.py`:**
- Progress-Callback wird periodisch (alle 0.5 Sekunden) aufgerufen
- Initialer Callback beim Start der Extraktion
- Zeit-basierte Updates zusÃ¤tzlich zu Prozent-basierten Updates
- `last_callback_time` Tracking fÃ¼r periodische Updates

**`src/cineripr/web/static/js/app.js`:**
- Separates Update fÃ¼r Progress-Bar bei kleinen Ã„nderungen
- `progressChanged` Check: Wenn sich nur `archive_progress` Ã¤ndert, nur Progress-Bar aktualisieren
- Nicht nur bei `releaseChanged`, sondern auch separat
- FlÃ¼ssige Updates ohne vollstÃ¤ndiges Re-Rendering

### Root Cause Analysis

1. **History Duplikate:**
   - Datenbank enthielt bereits Duplikate (vor v2.5.13 erstellt)
   - Beim Laden wurden alle EintrÃ¤ge inklusive Duplikate geladen
   - `add_to_history()` deduplizierte nur bei neuen EintrÃ¤gen
   - â†’ LÃ¶sung: Deduplizierung beim Laden

2. **Progress Updates:**
   - Progress-Callback wurde nur bei ProzentÃ¤nderung aufgerufen
   - 7-Zip gibt nicht immer kontinuierliche Updates
   - Frontend prÃ¼fte nur bei `releaseChanged`
   - â†’ LÃ¶sung: Periodische Updates + separates Frontend-Update

## ğŸ“Š Migration Notes

**Keine Migration erforderlich:**
- Dies ist ein reiner Bug-Fix und Improvement Release
- Keine Datenbank-Ã„nderungen
- Keine Konfigurations-Ã„nderungen
- Einfach Container neu starten mit neuer Version
- Bestehende History-Duplikate werden beim nÃ¤chsten Laden automatisch dedupliziert

## ğŸš€ Deployment

- **Docker Image:** `ghcr.io/rokk001/cineripr:2.5.15`
- **Version:** `2.5.15`
- **Breaking Changes:** Keine
- **Migration Required:** Nein

## âš ï¸ Wichtige Hinweise

- **History wird beim Laden dedupliziert:** Bestehende Duplikate werden automatisch aggregiert
- **Progress Updates:** Progress wird jetzt kontinuierlich aktualisiert, nicht nur bei ProzentÃ¤nderung
- **Bessere UX:** FlÃ¼ssige Updates wÃ¤hrend der Extraktion fÃ¼r bessere Benutzererfahrung

