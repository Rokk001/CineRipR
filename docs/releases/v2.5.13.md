# Release Notes v2.5.13

**Release Date:** 2025-11-13  
**Type:** Bug Fix Release

## ğŸ› Critical Bug Fixes

### Queue Duplikate verhindert

**Problem:** Die Queue wurde endlos mit identischen EintrÃ¤gen gefÃ¼llt. Ein Titel konnte mehrfach in der Queue erscheinen.

**LÃ¶sung:**
- `add_to_queue()` prÃ¼ft jetzt, ob ein Eintrag mit demselben Namen bereits existiert
- Wenn vorhanden, wird der bestehende Eintrag aktualisiert (Status auf "pending" gesetzt, Archive-Count aktualisiert)
- Verhindert endlose Queue-FÃ¼llung mit identischen EintrÃ¤gen

**Impact:**
- Queue bleibt Ã¼bersichtlich und enthÃ¤lt jeden Titel nur einmal
- Bestehende EintrÃ¤ge werden aktualisiert statt dupliziert

### History Duplikate verhindert

**Problem:** In der History wurde fÃ¼r einen Titel unzÃ¤hlige Male ein Eintrag erstellt - einmal pro Run. Dies fÃ¼hrte zu einer unÃ¼bersichtlichen History mit vielen identischen EintrÃ¤gen.

**LÃ¶sung:**
- `add_to_history()` prÃ¼ft jetzt, ob bereits ein Eintrag fÃ¼r denselben Release existiert
- Wenn vorhanden, wird der bestehende Eintrag aktualisiert:
  - `attempt_count` wird inkrementiert
  - Status wird auf den neuesten Status aktualisiert
  - Timestamp wird aktualisiert
  - Fehlermeldungen werden zusammengefÃ¼hrt (max. 10 unique errors)
- History zeigt jetzt: "Release Name (3x versucht)" wenn mehrfach versucht wurde

**Impact:**
- History bleibt Ã¼bersichtlich - jeder Titel erscheint nur einmal
- Versuchsanzahl wird klar angezeigt
- Bessere Ãœbersicht Ã¼ber fehlgeschlagene Versuche

### Check Interval Problem behoben

**Problem:** Check Interval war auf 35 min eingestellt, aber die Progressbar startete immer nach 2 min neu. Die 35 min wurden nicht berÃ¼cksichtigt.

**LÃ¶sung:**
- `set_next_run()` wird jetzt immer aufgerufen, wenn `repeat_forever` aktiv ist und `repeat_after_minutes > 0`
- EinstellungsÃ¤nderungen werden sofort in der Progressbar reflektiert
- Progressbar verwendet jetzt korrekt das konfigurierte Check Interval

**Impact:**
- Progressbar zeigt jetzt korrekt das konfigurierte Interval (z.B. 35 min)
- EinstellungsÃ¤nderungen werden sofort sichtbar
- Countdown funktioniert korrekt

## ğŸ¯ Improvements

### History Anzeige

- Versuchsanzahl wird in der History angezeigt: "Release Name (3x versucht)"
- Nur wenn `attempt_count > 1`, sonst keine Anzeige
- Bessere Ãœbersicht Ã¼ber fehlgeschlagene Versuche

## ğŸ”§ Technical Details

### Code Changes

**`src/cineripr/web/status.py`:**
- `ReleaseHistory` erweitert um `attempt_count: int = 1`
- `add_to_queue()` prÃ¼ft auf Duplikate und aktualisiert bestehende EintrÃ¤ge
- `add_to_history()` prÃ¼ft auf Duplikate und inkrementiert `attempt_count`
- `to_dict()` gibt jetzt `attempt_count` zurÃ¼ck
- `load_history()` berÃ¼cksichtigt `attempt_count` beim Laden aus DB

**`src/cineripr/web/settings_db.py`:**
- Datenbank-Schema erweitert um `attempt_count INTEGER DEFAULT 1`
- Migration hinzugefÃ¼gt fÃ¼r bestehende Datenbanken (v2.5.13)
- `save_history()` und `load_history()` aktualisiert

**`src/cineripr/web/static/js/app.js`:**
- History-Anzeige zeigt Versuchsanzahl: `(3x versucht)`
- Nur wenn `attempt_count > 1`

**`src/cineripr/web/routes/settings.py`:**
- `set_next_run()` wird jetzt immer aufgerufen, wenn `repeat_forever` aktiv ist
- Stellt sicher, dass Progressbar das korrekte Interval verwendet

### Database Migration

Die Datenbank wird automatisch migriert:
- Spalte `attempt_count` wird zur `history` Tabelle hinzugefÃ¼gt (falls nicht vorhanden)
- Bestehende EintrÃ¤ge erhalten `attempt_count = 1` als Default

## ğŸ“Š Migration Notes

**Automatisch:**
- Datenbank-Migration lÃ¤uft automatisch beim Start
- Bestehende History-EintrÃ¤ge erhalten `attempt_count = 1`
- Keine manuellen Schritte erforderlich

**Manuell (optional):**
- Bestehende History-EintrÃ¤ge kÃ¶nnen manuell konsolidiert werden
- Dies ist jedoch nicht erforderlich - neue EintrÃ¤ge werden automatisch konsolidiert

## ğŸš€ Deployment

- **Docker Image:** `ghcr.io/rokk001/cineripr:2.5.13`
- **Version:** `2.5.13`
- **Breaking Changes:** Keine
- **Migration Required:** Automatisch beim Start

