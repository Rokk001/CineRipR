# Release Notes v2.5.16

**Release Date:** 2025-11-13  
**Type:** UX & Performance Improvements

## âœ¨ Highlights

- Removed the always-on system-health polling thread â€“ CineRipR idles below 1â€¯% CPU again
- New `/api/system-health` endpoint plus WebGUI button for on-demand refreshes
- Status tracker now remembers disk paths + 7-Zip binary to serve accurate metrics whenever requested

## ğŸ§  On-Demand System Health

### Problem
- CLI updated CPU/RAM/Disk stats every 30 seconds even when no processing was running
- Each update executed multiple `subprocess.run()` calls (7-Zip) + `psutil` + `shutil.disk_usage`
- Containers stayed at 8â€“10â€¯% CPU while â€œIdleâ€

### Fix
- Removed the periodic background thread and countdown-loop refreshes
- `StatusTracker` keeps track of monitored paths and the resolved 7-Zip command
- New helper `_detect_seven_zip_version()` runs only when data is explicitly refreshed
- Added `configure_system_health_sources()` so CLI registers paths once during startup

### Result
- No disk/CPU polling while CineRipR waits -> host returns to real idle
- Metrics stay available via cached values and are refreshed when the user asks for them

## ğŸŒ WebGUI & API

- Added `/api/system-health` (GET/POST). `POST` or `?refresh=1` triggers a fresh measurement, otherwise the current cache is returned
- System Health tab now shows a "ğŸ”„ Refresh Metrics" button and auto-refreshes when the tab becomes active
- Small layout polish: shared card header row + explanatory hint text
- Frontend renders fresh metrics immediately via new `renderSystemHealth()` helper

## ğŸ§± Technical Changes

- `src/cineripr/cli.py`
  - Removed background system-health thread + sleep-loop refresh logic
  - Passes monitor paths + resolved 7-Zip command to tracker via `configure_system_health_sources`
- `src/cineripr/web/status.py`
  - Stores monitor paths and command, adds `_detect_seven_zip_version()`
  - `update_system_health` now falls back to stored paths when none are passed
- `src/cineripr/web/routes/api.py`
  - Added `/api/system-health` route for on-demand refresh/cached reads
- `src/cineripr/web/templates/index.html`
  - Tab buttons pass `event`, System Health card gets refresh button + hint
- `src/cineripr/web/static/js/app.js`
  - New `refreshSystemHealthData()` + `renderSystemHealth()` helpers
  - Tab switch triggers on-demand refresh when opening the System Health tab
- `src/cineripr/web/static/css/style.css`
  - Styling for card header rows, hints, and refresh button

## ğŸ“¦ Deployment

- **Version:** `2.5.16`
- **Docker Image:** `ghcr.io/rokk001/cineripr:2.5.16`
- **Breaking changes:** None
- **Migration:** Not required â€“ restart container with the new tag

## âœ… Verification Checklist

- [x] WebGUI idle CPU observed < 1â€¯% after migration
- [x] Manual refresh updates disks/CPU/memory immediately
- [x] Countdown + processing logic untouched
