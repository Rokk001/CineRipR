<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineRipR - Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="particles" id="particles"></div>
    <div class="toast-container" id="toast-container"></div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="header-icon">üé¨</div>
                <div class="header-text">
                    <h1>CineRipR</h1>
                    <div class="subtitle">Archive Extraction Dashboard <span style="opacity: 0.6; font-size: 0.9em;">v{{ version }}</span></div>
                </div>
            </div>
            <div class="header-right">
                <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span>
                </button>
                <div class="header-status-wrapper">
                    <div class="header-status-basic">
                        <div class="status-dot" id="status-dot"></div>
                        <div id="status-text">Idle</div>
                    </div>
                    <!-- Countdown Progressbar (only visible when idle) -->
                    <div class="countdown-progressbar-container" id="countdown-container" style="display: none;">
                        <div class="countdown-progressbar">
                            <div class="countdown-progressbar-fill" id="countdown-fill" style="width: 0%;"></div>
                            <div class="countdown-progressbar-text">
                                <span id="countdown-time">--:--</span>
                            </div>
                            <button class="countdown-run-now-btn" id="run-now-btn" onclick="triggerRunNow()" title="Start processing now">
                                ‚è≠Ô∏è
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('overview')">
                üìä Overview
            </button>
            <button class="nav-tab" onclick="switchTab('queue')">
                üìã Queue
            </button>
            <button class="nav-tab" onclick="switchTab('health')">
                üíª System Health
            </button>
            <button class="nav-tab" onclick="switchTab('history')">
                üìÖ History
            </button>
            <button class="nav-tab" onclick="switchTab('logs')">
                üìù Logs
            </button>
            <button class="nav-tab" onclick="switchTab('settings')">
                ‚öôÔ∏è Settings
            </button>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-content active" id="tab-overview">
            <!-- Stats -->
            <div class="card">
                <h2>üìà Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card success">
                        <div class="stat-label">‚úì Processed</div>
                        <div class="stat-value" id="processed">0</div>
                    </div>
                    <div class="stat-card error">
                        <div class="stat-label">‚úó Failed</div>
                        <div class="stat-value" id="failed">0</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">‚ö† Not Supported</div>
                        <div class="stat-value" id="unsupported">0</div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-label">üóë Deleted</div>
                        <div class="stat-value" id="deleted">0</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">üì¶ Extracted</div>
                        <div class="stat-value" id="extracted">0</div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-label">üìÑ Copied</div>
                        <div class="stat-value" id="copied">0</div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-label">‚û°Ô∏è Moved</div>
                        <div class="stat-value" id="moved">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Current Operation -->
            <div class="card">
                <h2>‚öôÔ∏è Current Operation</h2>
                <div id="current-operation-content">
                    <div style="margin-bottom: 15px;">
                        <div style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 5px;">Release</div>
                        <div style="color: var(--text-primary); font-weight: 500; font-size: 1.1em;" id="release-name">-</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 5px;">
                            Progress: <span id="progress-text" style="color: var(--text-primary); font-weight: 600;">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div style="margin-bottom: 10px;">
                            <div style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 5px;">Current Archive</div>
                            <div style="color: var(--text-primary); font-weight: 500;" id="archive-name">-</div>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.9em;" id="status-message">
                            Waiting for files...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Next Run Countdown (NEW in v2.1.0) -->
            <div class="card" id="next-run-card" style="display: none;">
                <h2>‚è∞ Next Run</h2>
                <div class="next-run-display">
                    <div class="countdown-time" id="next-run-countdown">--:--:--</div>
                    <div class="countdown-text" id="next-run-text">Calculating...</div>
                    <button class="control-btn trigger" onclick="triggerRunNow()">
                        <span>‚è≠Ô∏è</span> Run Now
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Queue Tab -->
        <div class="tab-content" id="tab-queue">
            <div class="card">
                <h2>üìã Processing Queue</h2>
                <div class="queue-list" id="queue-list">
                    <div class="queue-empty">No items in queue</div>
                </div>
            </div>
        </div>
        
        <!-- System Health Tab -->
        <div class="tab-content" id="tab-health">
            <div class="card">
                <h2>üíª Disk Space</h2>
                <div class="disk-grid">
                    <div class="disk-item">
                        <div class="disk-header">
                            <div class="disk-label">üì• Downloads</div>
                            <div class="disk-percent" id="disk-downloads-percent">0%</div>
                        </div>
                        <div class="disk-bar">
                            <div class="disk-fill" id="disk-downloads-fill"></div>
                        </div>
                        <div class="disk-stats">
                            <span id="disk-downloads-used">0 GB used</span>
                            <span id="disk-downloads-free">0 GB free</span>
                        </div>
                    </div>
                    
                    <div class="disk-item">
                        <div class="disk-header">
                            <div class="disk-label">üì¶ Extracted</div>
                            <div class="disk-percent" id="disk-extracted-percent">0%</div>
                        </div>
                        <div class="disk-bar">
                            <div class="disk-fill" id="disk-extracted-fill"></div>
                        </div>
                        <div class="disk-stats">
                            <span id="disk-extracted-used">0 GB used</span>
                            <span id="disk-extracted-free">0 GB free</span>
                        </div>
                    </div>
                    
                    <div class="disk-item">
                        <div class="disk-header">
                            <div class="disk-label">‚úÖ Finished</div>
                            <div class="disk-percent" id="disk-finished-percent">0%</div>
                        </div>
                        <div class="disk-bar">
                            <div class="disk-fill" id="disk-finished-fill"></div>
                        </div>
                        <div class="disk-stats">
                            <span id="disk-finished-used">0 GB used</span>
                            <span id="disk-finished-free">0 GB free</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>üîß System Information</h2>
                <div style="padding: 15px; background: var(--stat-bg); border-radius: 10px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <div style="color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">CineRipR Version</div>
                            <div style="color: var(--text-primary); font-weight: 500; font-size: 1.1em;" id="cineripr-version">{{ version }}</div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">7-Zip Version</div>
                            <div style="color: var(--text-primary); font-weight: 500; font-size: 1.1em;" id="seven-zip-version">Unknown</div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">CPU Usage</div>
                            <div style="color: var(--text-primary); font-weight: 500; font-size: 1.1em;" id="cpu-usage">0%</div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">Memory Usage</div>
                            <div style="color: var(--text-primary); font-weight: 500; font-size: 1.1em;" id="memory-usage">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Tab -->
        <div class="tab-content" id="tab-history">
            <div class="card">
                <h2>üìÖ Processing History</h2>
                <div class="timeline" id="history-timeline">
                    <div class="history-empty">
                        <div class="history-empty-icon">üïê</div>
                        <div style="font-size: 1.2em; margin-bottom: 10px;">No history yet</div>
                        <div>Processed releases will appear here</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Logs Tab -->
        <div class="tab-content" id="tab-logs">
            <div class="card">
                <h2>üìù Logs</h2>
                <div class="log-controls">
                    <select class="log-filter" id="log-filter">
                        <option value="all">All Levels</option>
                        <option value="error">Errors</option>
                        <option value="warning">Warnings</option>
                        <option value="info">Info</option>
                        <option value="debug">Debug</option>
                    </select>
                    <input type="text" class="log-search" id="log-search" placeholder="Search logs...">
                </div>
                <div class="logs-container" id="logs-container"></div>
            </div>
        </div>
        
        <!-- Settings Tab (NEW in v2.2.0) -->
        <div class="tab-content" id="tab-settings">
            <div class="card">
                <h2>‚öôÔ∏è Settings</h2>
                <p style="color: var(--text-secondary); margin-bottom: 25px;">
                    Configure CineRipR directly from the WebGUI. Changes are saved immediately and take effect on the next run.
                </p>
                
                <!-- Settings Categories -->
                <div class="settings-categories">
                    <!-- Scheduling -->
                    <div class="settings-category">
                        <h3>üïê Scheduling</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-repeat-forever" />
                                    <span>Enable Auto-Run (Repeat Forever)</span>
                                </label>
                                <p class="setting-help">Automatically run processing in intervals</p>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">Check Interval (minutes)</label>
                                <input type="number" id="setting-repeat-minutes" min="1" max="1440" class="setting-input" />
                                <p class="setting-help">Time between automatic runs (1-1440 minutes)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Retention -->
                    <div class="settings-category">
                        <h3>üóëÔ∏è Retention & Cleanup</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">Retention Days</label>
                                <input type="number" id="setting-retention-days" min="1" max="365" class="setting-input" />
                                <p class="setting-help">Days to keep files in finished directory</p>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-enable-delete" />
                                    <span>Enable Automatic Deletion</span>
                                </label>
                                <p class="setting-help">‚ö†Ô∏è Automatically delete files after retention period</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Subfolders -->
                    <div class="settings-category">
                        <h3>üìÇ Subfolder Processing</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-include-sample" />
                                    <span>Include Sample Directories</span>
                                </label>
                                <p class="setting-help">Process 'Sample' folders (preview videos)</p>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-include-sub" />
                                    <span>Include Subtitle Directories</span>
                                </label>
                                <p class="setting-help">Process 'Subs'/'Sub' folders</p>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-include-other" />
                                    <span>Include Other Subdirectories</span>
                                </label>
                                <p class="setting-help">Process other folders (Proof, extras, etc.)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- UI Preferences -->
                    <div class="settings-category">
                        <h3>üé® UI Preferences</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-toast-notifications" />
                                    <span>Enable Toast Notifications</span>
                                </label>
                                <p class="setting-help">Show pop-up notifications for events</p>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-toast-sound" />
                                    <span>Enable Notification Sounds</span>
                                </label>
                                <p class="setting-help">Play sound with notifications</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Processing -->
                    <div class="settings-category">
                        <h3>üìÅ File Processing</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">File Stability Hours</label>
                                <input type="number" id="setting-file-stability-hours" min="1" max="168" class="setting-input" />
                                <p class="setting-help">Hours an already extracted file (e.g., MKV) must be unchanged before processing. Only applies to non-archive files. Archives are processed immediately. (default: 24)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced -->
                    <div class="settings-category">
                        <h3>üîß Advanced</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="setting-demo-mode" />
                                    <span>Demo Mode</span>
                                </label>
                                <p class="setting-help">‚ö†Ô∏è Simulate operations without making changes</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="settings-actions">
                    <button class="control-btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" onclick="saveAllSettings()">
                        <span>üíæ</span> Save All Settings
                    </button>
                    <button class="control-btn" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);" onclick="resetSettings()">
                        <span>üîÑ</span> Reset to Defaults
                    </button>
                </div>
                
                <div id="settings-status" class="settings-status" style="display: none;"></div>
            </div>
        </div>
        
        <div class="footer">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></span>
                    Last update: <span id="last-update">-</span>
                </div>
                <div>CineRipR v{{ version }}</div>
                <div>
                    <a href="https://github.com/Rokk001/CineRipR" target="_blank" rel="noopener noreferrer" style="color: rgba(255, 255, 255, 0.6); text-decoration: none; display: flex; align-items: center; gap: 6px; transition: color 0.3s;">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="flex-shrink: 0;">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        GitHub
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Release Detail Modal -->
    <div class="modal-overlay" id="release-modal" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Release Details</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="modal-section-title">üìã Information</div>
                    <div class="modal-detail-grid">
                        <div class="modal-detail-item">
                            <div class="modal-detail-label">Status</div>
                            <div class="modal-detail-value" id="modal-status">-</div>
                        </div>
                        <div class="modal-detail-item">
                            <div class="modal-detail-label">Archive Count</div>
                            <div class="modal-detail-value" id="modal-archive-count">-</div>
                        </div>
                        <div class="modal-detail-item">
                            <div class="modal-detail-label">Start Time</div>
                            <div class="modal-detail-value" id="modal-start-time">-</div>
                        </div>
                        <div class="modal-detail-item">
                            <div class="modal-detail-label">Duration</div>
                            <div class="modal-detail-value" id="modal-duration">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section" id="modal-progress-section" style="display: none;">
                    <div class="modal-section-title">üìä Progress</div>
                    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px;">
                        <div style="margin-bottom: 10px; font-size: 0.9em; color: rgba(255, 255, 255, 0.7);">
                            <strong>Current:</strong> <span id="modal-current-archive">-</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="modal-progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <div class="modal-section-title">üìù Logs</div>
                    <div class="modal-logs" id="modal-logs">
                        <div style="text-align: center; color: rgba(255, 255, 255, 0.4); padding: 20px;">
                            No logs available for this release
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>